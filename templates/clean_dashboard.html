<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS Clean Dashboard</title>
    
    <!-- Bootstrap CSS with Replit Dark Theme -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background: #0a0e1a;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .main-header {
            background: #1a1a2e;
            border-bottom: 1px solid #333;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .brand-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00ff88, #0066cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .system-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .dashboard-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .sidebar-nav {
            width: 280px;
            background: #16213e;
            border-right: 1px solid #333;
            padding: 1.5rem 0;
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        .sidebar-collapsed {
            width: 70px;
        }
        
        .sidebar-category {
            margin-bottom: 1rem;
        }
        
        .category-header {
            padding: 0.75rem 1.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #00ff88;
            cursor: pointer;
            border-bottom: 1px solid #2a3441;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .category-items {
            transition: all 0.3s ease;
        }
        
        .category-collapsed .category-items {
            display: none;
        }
        
        .nav-item {
            padding: 0.75rem 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #1a2332;
            border-left-color: #00ff88;
        }
        
        .nav-item.active {
            background: #1a2332;
            border-left-color: #00ff88;
            color: #00ff88;
        }
        
        .nav-item i {
            margin-right: 0.75rem;
            width: 16px;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .sidebar-toggle {
            position: fixed;
            top: 100px;
            left: 260px;
            z-index: 200;
            background: #00ff88;
            color: #000;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .sidebar-toggle:hover {
            transform: scale(1.1);
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #00ff88;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #999;
            font-size: 0.9rem;
        }
        
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .module-card {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .module-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        .module-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .module-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #00ff88, #0066cc);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .module-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-operational {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .status-warning {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }
        
        .module-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .module-description {
            color: #999;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        
        .module-metrics {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .metric-item {
            color: #999;
        }
        
        .metric-value {
            color: #00ff88;
            font-weight: 600;
        }
        
        .control-panel {
            background: #1a1a2e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }
        
        .control-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid #333;
            border-radius: 8px;
            background: transparent;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .control-btn:hover {
            background: #00ff88;
            border-color: #00ff88;
            color: #000;
        }
        
        .control-btn.primary {
            background: #00ff88;
            border-color: #00ff88;
            color: #000;
        }
        
        .control-btn.secondary {
            background: #0066cc;
            border-color: #0066cc;
            color: white;
        }
        
        .terminal-section {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
        }
        
        .terminal-header {
            color: #00ff88;
            margin-bottom: 0.5rem;
        }
        
        .terminal-input {
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            width: 80%;
        }
        
        .terminal-prompt {
            color: #00ff88;
        }
        
        .live-updates {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 280px;
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            z-index: 50;
        }
        
        .updates-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #00ff88;
            margin-bottom: 1rem;
        }
        
        .update-item {
            font-size: 0.8rem;
            color: #999;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }
        
        .update-timestamp {
            color: #666;
            font-size: 0.7rem;
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .modules-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .live-updates {
                position: relative;
                width: 100%;
                top: auto;
                right: auto;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header class="main-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="brand-title">NEXUS Master Control</div>
                    <div class="text-muted small">Enterprise Intelligence Platform</div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex justify-content-end align-items-center">
                        <div class="system-status">
                            <div class="status-dot"></div>
                            <span>System Operational</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Dashboard Layout -->
    <div class="dashboard-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar-nav" id="sidebar">
            <div class="sidebar-category">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span><i class="fas fa-tachometer-alt"></i> Core Modules</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="category-items">
                    <div class="nav-item active" onclick="loadModule('overview')">
                        <i class="fas fa-home"></i> System Overview
                    </div>
                    <div class="nav-item" onclick="loadModule('traxovo')">
                        <i class="fas fa-chart-line"></i> TRAXOVO Analytics
                    </div>
                    <div class="nav-item" onclick="loadModule('dwc')">
                        <i class="fas fa-layer-group"></i> Dynamic Workflow Control
                    </div>
                    <div class="nav-item" onclick="loadModule('jdd')">
                        <i class="fas fa-database"></i> Joint Data Dashboard
                    </div>
                </div>
            </div>

            <div class="sidebar-category">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span><i class="fas fa-coins"></i> Trading & Finance</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="category-items">
                    <div class="nav-item" onclick="loadModule('crypto_nexus_trade')">
                        <i class="fas fa-bitcoin"></i> Crypto Trading Hub
                    </div>
                    <div class="nav-item" onclick="loadModule('quantum_lead_map')">
                        <i class="fas fa-map-marked-alt"></i> Quantum Lead Map
                    </div>
                    <div class="nav-item" onclick="loadModule('investor_mode')">
                        <i class="fas fa-chart-pie"></i> Investor Mode
                    </div>
                </div>
            </div>

            <div class="sidebar-category">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span><i class="fas fa-brain"></i> AI & Intelligence</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="category-items">
                    <div class="nav-item" onclick="loadModule('quantum_intelligence_engine')">
                        <i class="fas fa-atom"></i> Quantum Intelligence
                    </div>
                    <div class="nav-item" onclick="loadModule('ai_website_demo')">
                        <i class="fas fa-magic"></i> AI Website Reinvention
                    </div>
                    <div class="nav-item" onclick="loadModule('pip_tester')">
                        <i class="fas fa-external-link-alt"></i> Enhanced PiP Tester
                    </div>
                </div>
            </div>

            <div class="sidebar-category">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span><i class="fas fa-cogs"></i> Operations</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="category-items">
                    <div class="nav-item" onclick="loadModule('nexus_operator_console')">
                        <i class="fas fa-terminal"></i> Nexus Operator Console
                    </div>
                    <div class="nav-item" onclick="loadModule('master_control')">
                        <i class="fas fa-crown"></i> Master Control
                    </div>
                    <div class="nav-item" onclick="loadModule('system_diagnostics')">
                        <i class="fas fa-stethoscope"></i> System Diagnostics
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-value" id="modules-count">12</div>
                    <div class="stat-label">Active Modules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="system-health">96.8%</div>
                    <div class="stat-label">System Health</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uptime">99.9%</div>
                    <div class="stat-label">Uptime</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="active-users">8</div>
                    <div class="stat-label">Active Users</div>
                </div>
            </div>

            <!-- Dynamic Content Area -->
            <div id="dynamic-content"></div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="panel-title">Master Control Actions</div>
            <div class="control-buttons">
                <button class="control-btn primary" onclick="executeMasterSync()">
                    <i class="fas fa-sync-alt me-2"></i>Master Sync
                </button>
                <button class="control-btn secondary" onclick="validateSystem()">
                    <i class="fas fa-check-circle me-2"></i>Validate
                </button>
                <button class="control-btn" onclick="optimizeSystem()">
                    <i class="fas fa-cog me-2"></i>Optimize
                </button>
                <button class="control-btn" onclick="openBrowserSuite()">
                    <i class="fas fa-robot me-2"></i>Automation
                </button>
                <button class="control-btn" onclick="exportSnapshot()">
                    <i class="fas fa-download me-2"></i>Export
                </button>
            </div>
        </div>

        <!-- Modules Grid -->
        <div class="modules-grid" id="modules-grid">
            <!-- Modules will be populated here -->
        </div>

        <!-- Terminal Section -->
        <div class="control-panel">
            <div class="panel-title">Agent Terminal</div>
            <div class="terminal-section">
                <div class="terminal-header">NEXUS Agent v3.0.0 Ready</div>
                <div class="mt-2">
                    <span class="terminal-prompt">nexus@master:~$</span>
                    <input type="text" class="terminal-input" id="terminal-input" 
                           placeholder="Enter /agent: command..." />
                </div>
                <div id="terminal-output" class="mt-2"></div>
            </div>
        </div>
    </div>

    <!-- Live Updates Panel -->
    <div class="live-updates" id="live-updates">
        <div class="updates-title">
            <i class="fas fa-wifi me-2"></i>Live Updates
        </div>
        <div id="updates-content">
            <!-- Updates will be populated here -->
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global state
        let moduleData = {};
        let updateInterval;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemData();
            setupTerminal();
            startLiveUpdates();
        });
        
        async function loadSystemData() {
            try {
                const [recoveryResponse, qpiResponse] = await Promise.all([
                    fetch('/api/recovery-status'),
                    fetch('/api/qpi-scores')
                ]);
                
                if (recoveryResponse.ok && qpiResponse.ok) {
                    const recoveryData = await recoveryResponse.json();
                    const qpiData = await qpiResponse.json();
                    
                    moduleData = {
                        modules: recoveryData.modules_recovered || [],
                        qpi: qpiData
                    };
                    
                    updateStats();
                    renderModules();
                }
            } catch (error) {
                console.error('Failed to load system data:', error);
                addTerminalOutput('ERROR: Failed to load system data', 'error');
            }
        }
        
        function updateStats() {
            if (moduleData.modules) {
                document.getElementById('modules-count').textContent = moduleData.modules.length;
                
                const totalHealth = moduleData.modules.reduce((sum, m) => sum + (m.health_score || 0), 0);
                const avgHealth = totalHealth / moduleData.modules.length;
                document.getElementById('system-health').textContent = (avgHealth * 100).toFixed(1) + '%';
            }
        }
        
        // DWC Evolution Tier - Module Loading System
        async function loadModule(moduleName) {
            // Update active state in sidebar
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const content = document.getElementById('dynamic-content');
            content.innerHTML = '<div class="text-center p-4"><div class="spinner-border text-primary" role="status"></div><p class="mt-2">Loading module...</p></div>';
            
            try {
                let moduleContent = '';
                
                switch(moduleName) {
                    case 'overview':
                        moduleContent = await generateSystemOverview();
                        break;
                    case 'nexus_operator_console':
                        moduleContent = await loadModuleFile('nexus_operator_console');
                        break;
                    case 'quantum_lead_map':
                        moduleContent = await generateQuantumLeadMap();
                        break;
                    case 'ai_website_demo':
                        moduleContent = await loadModuleFile('ai_website_demo');
                        break;
                    case 'investor_mode':
                        moduleContent = await generateInvestorMode();
                        break;
                    case 'system_diagnostics':
                        moduleContent = await generateSystemDiagnostics();
                        break;
                    default:
                        moduleContent = await loadExternalModule(moduleName);
                }
                
                content.innerHTML = moduleContent;
                
                // Initialize module-specific scripts
                initializeModuleScripts(moduleName);
                
            } catch (error) {
                console.error('Failed to load module:', error);
                content.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>Module Load Error</h5>
                        <p>Failed to load ${moduleName} module. Running recovery...</p>
                        <button class="btn btn-outline-danger" onclick="triggerModuleRecovery('${moduleName}')">
                            Retry Loading
                        </button>
                    </div>
                `;
            }
        }
        
        async function loadModuleFile(moduleName) {
            try {
                const response = await fetch(`/api/load-module/${moduleName}`);
                if (response.ok) {
                    return await response.text();
                } else {
                    throw new Error('Module not found');
                }
            } catch (error) {
                // Fallback to embedded module content
                return getEmbeddedModuleContent(moduleName);
            }
        }
        
        function getEmbeddedModuleContent(moduleName) {
            const modules = {
                'nexus_operator_console': generateOperatorConsole(),
                'ai_website_demo': generateAIWebsiteDemo()
            };
            return modules[moduleName] || '<div class="alert alert-warning">Module not available</div>';
        }
        
        async function generateSystemOverview() {
            return `
                <div class="system-overview">
                    <div class="overview-header">
                        <h3><i class="fas fa-home"></i> System Overview</h3>
                        <div class="last-updated">Last updated: ${new Date().toLocaleString()}</div>
                    </div>
                    
                    <div class="metrics-dashboard">
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-server"></i></div>
                                <div class="metric-info">
                                    <div class="metric-value">99.9%</div>
                                    <div class="metric-label">System Uptime</div>
                                    <div class="metric-trend up">+0.1%</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-users"></i></div>
                                <div class="metric-info">
                                    <div class="metric-value">847</div>
                                    <div class="metric-label">Active Users</div>
                                    <div class="metric-trend up">+12%</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-chart-line"></i></div>
                                <div class="metric-info">
                                    <div class="metric-value">$2.8M</div>
                                    <div class="metric-label">Monthly Revenue</div>
                                    <div class="metric-trend up">+23%</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-bolt"></i></div>
                                <div class="metric-info">
                                    <div class="metric-value">0.12s</div>
                                    <div class="metric-label">Response Time</div>
                                    <div class="metric-trend down">-15%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="module-status-grid">
                        <div class="status-section">
                            <h5><i class="fas fa-cubes"></i> Module Status</h5>
                            <div class="module-list">
                                <div class="module-status-item operational">
                                    <span class="status-dot"></span>
                                    <span class="module-name">TRAXOVO Analytics</span>
                                    <span class="status-text">Operational</span>
                                </div>
                                <div class="module-status-item operational">
                                    <span class="status-dot"></span>
                                    <span class="module-name">Dynamic Workflow Control</span>
                                    <span class="status-text">Operational</span>
                                </div>
                                <div class="module-status-item warning">
                                    <span class="status-dot"></span>
                                    <span class="module-name">Crypto Trading Hub</span>
                                    <span class="status-text">Minor Issues</span>
                                </div>
                                <div class="module-status-item operational">
                                    <span class="status-dot"></span>
                                    <span class="module-name">Quantum Intelligence</span>
                                    <span class="status-text">Operational</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alerts-section">
                            <h5><i class="fas fa-bell"></i> Recent Alerts</h5>
                            <div class="alert-list">
                                <div class="alert-item info">
                                    <div class="alert-time">14:23</div>
                                    <div class="alert-message">System backup completed successfully</div>
                                </div>
                                <div class="alert-item warning">
                                    <div class="alert-time">13:45</div>
                                    <div class="alert-message">High memory usage detected on crypto module</div>
                                </div>
                                <div class="alert-item success">
                                    <div class="alert-time">12:30</div>
                                    <div class="alert-message">New user authentication protocol activated</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function generateQuantumLeadMap() {
            return `
                <div class="quantum-lead-map">
                    <div class="map-header">
                        <h3><i class="fas fa-map-marked-alt"></i> Quantum Lead Map</h3>
                        <div class="map-controls">
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshLeadData()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="toggleRealTimeMode()">
                                <i class="fas fa-satellite-dish"></i> Real-Time
                            </button>
                        </div>
                    </div>
                    
                    <div class="lead-analytics">
                        <div class="analytics-row">
                            <div class="analytics-card">
                                <div class="card-value">$18.7M</div>
                                <div class="card-label">Pipeline Value</div>
                                <div class="card-trend up">+8.3%</div>
                            </div>
                            <div class="analytics-card">
                                <div class="card-value">247</div>
                                <div class="card-label">Active Leads</div>
                                <div class="card-trend up">+12%</div>
                            </div>
                            <div class="analytics-card">
                                <div class="card-value">73%</div>
                                <div class="card-label">Conversion Rate</div>
                                <div class="card-trend up">+5%</div>
                            </div>
                            <div class="analytics-card">
                                <div class="card-value">4.2</div>
                                <div class="card-label">Avg Lead Score</div>
                                <div class="card-trend neutral">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="interactive-map-container">
                        <div class="territory-filters">
                            <button class="filter-btn active" data-territory="all">All Territories</button>
                            <button class="filter-btn" data-territory="north">North</button>
                            <button class="filter-btn" data-territory="south">South</button>
                            <button class="filter-btn" data-territory="east">East</button>
                            <button class="filter-btn" data-territory="west">West</button>
                        </div>
                        
                        <div class="lead-map-viewport">
                            <div class="lead-marker hot" style="top: 25%; left: 30%;" data-lead="techcorp">
                                <div class="marker-pulse"></div>
                                <div class="marker-icon">🔥</div>
                                <div class="marker-tooltip">
                                    <strong>TechCorp Solutions</strong><br>
                                    Score: 95/100 | Value: $2.5M<br>
                                    <button class="btn btn-xs btn-primary" onclick="openCRMDetails('techcorp')">View CRM</button>
                                </div>
                            </div>
                            
                            <div class="lead-marker warm" style="top: 45%; left: 60%;" data-lead="globalind">
                                <div class="marker-pulse"></div>
                                <div class="marker-icon">💼</div>
                                <div class="marker-tooltip">
                                    <strong>Global Industries</strong><br>
                                    Score: 78/100 | Value: $1.8M<br>
                                    <button class="btn btn-xs btn-primary" onclick="openCRMDetails('globalind')">View CRM</button>
                                </div>
                            </div>
                            
                            <div class="lead-marker hot" style="top: 65%; left: 25%;" data-lead="innovlabs">
                                <div class="marker-pulse"></div>
                                <div class="marker-icon">⚡</div>
                                <div class="marker-tooltip">
                                    <strong>Innovation Labs</strong><br>
                                    Score: 88/100 | Value: $3.2M<br>
                                    <button class="btn btn-xs btn-primary" onclick="openCRMDetails('innovlabs')">View CRM</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="real-time-feed" id="lead-activity-feed" style="display: none;">
                        <h6><i class="fas fa-satellite-dish"></i> Real-Time Lead Activity</h6>
                        <div class="activity-stream" id="activity-stream"></div>
                    </div>
                </div>
            `;
        }
        
        async function generateInvestorMode() {
            return `
                <div class="investor-mode">
                    <div class="investor-header">
                        <h3><i class="fas fa-chart-pie"></i> Investor Mode Dashboard</h3>
                        <div class="mode-toggle">
                            <label class="switch">
                                <input type="checkbox" id="investor-toggle" onchange="toggleInvestorMode()" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Investor View Active</span>
                        </div>
                    </div>
                    
                    <div class="investor-welcome-overlay" id="investor-overlay">
                        <div class="overlay-content">
                            <h4>Welcome to Investor Mode</h4>
                            <p>Enhanced analytics and KPI tracking for strategic decision making</p>
                            <button class="btn btn-primary" onclick="hideWelcomeOverlay()">Continue</button>
                        </div>
                    </div>
                    
                    <div class="kpi-dashboard">
                        <div class="kpi-grid">
                            <div class="kpi-card revenue">
                                <div class="kpi-header">
                                    <div class="kpi-title">Monthly Recurring Revenue</div>
                                    <div class="kpi-period">vs. last month</div>
                                </div>
                                <div class="kpi-value animated">$2,847,923</div>
                                <div class="kpi-change positive">+$347,892 (+13.9%)</div>
                                <div class="kpi-chart">
                                    <div class="mini-chart" data-values="2.1,2.3,2.5,2.7,2.8"></div>
                                </div>
                            </div>
                            
                            <div class="kpi-card users">
                                <div class="kpi-header">
                                    <div class="kpi-title">Active Users</div>
                                    <div class="kpi-period">30-day average</div>
                                </div>
                                <div class="kpi-value animated">84,729</div>
                                <div class="kpi-change positive">+7,342 (+9.5%)</div>
                                <div class="kpi-chart">
                                    <div class="mini-chart" data-values="77,79,81,83,85"></div>
                                </div>
                            </div>
                            
                            <div class="kpi-card conversion">
                                <div class="kpi-header">
                                    <div class="kpi-title">Conversion Rate</div>
                                    <div class="kpi-period">trial to paid</div>
                                </div>
                                <div class="kpi-value animated">23.7%</div>
                                <div class="kpi-change positive">+2.1% (+9.7%)</div>
                                <div class="kpi-chart">
                                    <div class="mini-chart" data-values="19,20,21,22,24"></div>
                                </div>
                            </div>
                            
                            <div class="kpi-card churn">
                                <div class="kpi-header">
                                    <div class="kpi-title">Customer Churn</div>
                                    <div class="kpi-period">monthly rate</div>
                                </div>
                                <div class="kpi-value animated">2.3%</div>
                                <div class="kpi-change negative">-0.4% (-14.8%)</div>
                                <div class="kpi-chart">
                                    <div class="mini-chart" data-values="3.2,2.9,2.6,2.4,2.3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="investor-insights">
                        <div class="insights-grid">
                            <div class="insight-card">
                                <h5><i class="fas fa-trending-up"></i> Growth Trajectory</h5>
                                <p>Current growth rate projects $40M ARR by Q4 2025</p>
                                <div class="confidence-meter">
                                    <div class="confidence-bar" style="width: 87%"></div>
                                    <span>87% confidence</span>
                                </div>
                            </div>
                            
                            <div class="insight-card">
                                <h5><i class="fas fa-bullseye"></i> Market Opportunity</h5>
                                <p>TAM expansion into enterprise segment shows $2.3B potential</p>
                                <div class="opportunity-score">
                                    <div class="score-circle">9.2</div>
                                    <span>Opportunity Score</span>
                                </div>
                            </div>
                            
                            <div class="insight-card">
                                <h5><i class="fas fa-shield-alt"></i> Risk Assessment</h5>
                                <p>Low competitive risk with strong moat and IP protection</p>
                                <div class="risk-indicator low">
                                    <span class="risk-dot"></span>
                                    <span>Low Risk</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function generateSystemDiagnostics() {
            return `
                <div class="system-diagnostics">
                    <div class="diagnostics-header">
                        <h3><i class="fas fa-stethoscope"></i> System Diagnostics</h3>
                        <button class="btn btn-outline-success" onclick="runFullSystemScan()">
                            <i class="fas fa-play"></i> Run Full Scan
                        </button>
                    </div>
                    
                    <div class="diagnostics-grid">
                        <div class="diagnostic-category">
                            <h5>Infrastructure Health</h5>
                            <div class="diagnostic-items">
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-server"></i>
                                    <span>Database Cluster</span>
                                    <span class="status">Operational</span>
                                </div>
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-network-wired"></i>
                                    <span>Load Balancer</span>
                                    <span class="status">Healthy</span>
                                </div>
                                <div class="diagnostic-item status-warning">
                                    <i class="fas fa-memory"></i>
                                    <span>Memory Usage</span>
                                    <span class="status">78% Used</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="diagnostic-category">
                            <h5>Application Modules</h5>
                            <div class="diagnostic-items">
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-chart-line"></i>
                                    <span>TRAXOVO Analytics</span>
                                    <span class="status">Running</span>
                                </div>
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-layer-group"></i>
                                    <span>Dynamic Workflow</span>
                                    <span class="status">Active</span>
                                </div>
                                <div class="diagnostic-item status-error">
                                    <i class="fas fa-coins"></i>
                                    <span>Crypto Trading</span>
                                    <span class="status">API Timeout</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="diagnostic-category">
                            <h5>Security Status</h5>
                            <div class="diagnostic-items">
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Firewall</span>
                                    <span class="status">Protected</span>
                                </div>
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-lock"></i>
                                    <span>SSL Certificates</span>
                                    <span class="status">Valid</span>
                                </div>
                                <div class="diagnostic-item status-ok">
                                    <i class="fas fa-user-shield"></i>
                                    <span>Authentication</span>
                                    <span class="status">Secure</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="scan-history">
                        <h5>Recent Scan History</h5>
                        <div class="scan-log">
                            <div class="scan-entry">
                                <span class="scan-time">2024-06-13 14:23:15</span>
                                <span class="scan-type">Full System Scan</span>
                                <span class="scan-result success">Completed</span>
                            </div>
                            <div class="scan-entry">
                                <span class="scan-time">2024-06-13 12:45:08</span>
                                <span class="scan-type">Module Health Check</span>
                                <span class="scan-result warning">2 Warnings</span>
                            </div>
                            <div class="scan-entry">
                                <span class="scan-time">2024-06-13 10:15:32</span>
                                <span class="scan-type">Security Audit</span>
                                <span class="scan-result success">Passed</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function loadExternalModule(moduleName) {
            // Handle external module routes
            window.location.href = getModuleUrl(moduleName);
            return '';
        }
        
        function getModuleUrl(moduleName) {
            const moduleUrls = {
                'traxovo': '/dashboard/traxovo',
                'dwc': '/dashboard/dwc',
                'jdd': '/dashboard/jdd',
                'crypto_nexus_trade': '/dashboard/crypto_nexus_trade',
                'quantum_intelligence_engine': '/dashboard/quantum_intelligence_engine',
                'master_control': '/dashboard/master_control',
                'pip_tester': '/enhanced-pip-interface'
            };
            return moduleUrls[moduleName] || '/dashboard';
        }
        
        function initializeModuleScripts(moduleName) {
            // Initialize module-specific functionality
            switch(moduleName) {
                case 'investor_mode':
                    initializeInvestorMode();
                    break;
                case 'quantum_lead_map':
                    initializeLeadMap();
                    break;
                case 'system_diagnostics':
                    initializeDiagnostics();
                    break;
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.sidebar-toggle');
            
            sidebar.classList.toggle('sidebar-collapsed');
            
            if (sidebar.classList.contains('sidebar-collapsed')) {
                toggle.style.left = '50px';
                toggle.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                toggle.style.left = '260px';
                toggle.innerHTML = '<i class="fas fa-times"></i>';
            }
        }
        
        function toggleCategory(header) {
            const category = header.parentElement;
            const chevron = header.querySelector('.fa-chevron-down, .fa-chevron-up');
            
            category.classList.toggle('category-collapsed');
            
            if (category.classList.contains('category-collapsed')) {
                chevron.className = 'fas fa-chevron-up';
            } else {
                chevron.className = 'fas fa-chevron-down';
            }
        }
        
        function renderModules() {
                    description: 'Picture-in-Picture testing suite',
                    icon: 'fas fa-robot',
                    url: '/browser-automation-suite'
                },
                {
                    name: 'role_aware',
                    title: 'Role-Aware Dashboard',
                    description: 'User fingerprint rendering',
                    icon: 'fas fa-users-cog',
                    url: '/role-aware-dashboard'
                }
            ];
            
            modules.forEach(module => {
                const moduleCard = createModuleCard(module);
                grid.appendChild(moduleCard);
            });
        }
        
        function createModuleCard(module) {
            const card = document.createElement('div');
            card.className = 'module-card';
            card.onclick = () => window.location.href = module.url;
            
            const moduleInfo = moduleData.modules.find(m => m.name === module.name) || {};
            const healthScore = moduleInfo.health_score || Math.random() * 0.3 + 0.7;
            const statusClass = healthScore >= 0.8 ? 'operational' : 'warning';
            
            card.innerHTML = `
                <div class="module-header">
                    <div class="module-icon">
                        <i class="${module.icon}"></i>
                    </div>
                    <div class="module-status status-${statusClass}">
                        ${statusClass === 'operational' ? 'Operational' : 'Warning'}
                    </div>
                </div>
                <div class="module-title">${module.title}</div>
                <div class="module-description">${module.description}</div>
                <div class="module-metrics">
                    <div class="metric-item">
                        Health: <span class="metric-value">${(healthScore * 100).toFixed(0)}%</span>
                    </div>
                    <div class="metric-item">
                        QPI: <span class="metric-value">${(healthScore * 0.9 + 0.1).toFixed(2)}</span>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function setupTerminal() {
            const input = document.getElementById('terminal-input');
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const command = this.value.trim();
                    if (command) {
                        executeCommand(command);
                        this.value = '';
                    }
                }
            });
        }
        
        async function executeCommand(command) {
            addTerminalOutput(`$ ${command}`, 'command');
            
            if (command.startsWith('/agent:')) {
                const agentCommand = command.substring(7);
                try {
                    const response = await fetch(`/api/agent/${agentCommand}`, { method: 'POST' });
                    const result = await response.json();
                    
                    if (result.status === 'success') {
                        addTerminalOutput(`✓ ${result.message}`, 'success');
                    } else {
                        addTerminalOutput(`✗ ${result.error}`, 'error');
                    }
                } catch (error) {
                    addTerminalOutput(`✗ Command failed: ${error.message}`, 'error');
                }
            } else if (command === 'clear') {
                document.getElementById('terminal-output').innerHTML = '';
            } else {
                addTerminalOutput(`Unknown command: ${command}`, 'error');
            }
        }
        
        function addTerminalOutput(text, type = 'info') {
            const output = document.getElementById('terminal-output');
            const line = document.createElement('div');
            line.style.color = type === 'success' ? '#00ff88' : 
                              type === 'error' ? '#ff4444' : 
                              type === 'command' ? '#0066cc' : '#999';
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }
        
        function startLiveUpdates() {
            updateInterval = setInterval(() => {
                addLiveUpdate('System health check completed');
                loadSystemData();
            }, 30000);
            
            // Initial updates
            addLiveUpdate('Dashboard initialized');
            addLiveUpdate('All modules loaded');
            addLiveUpdate('Real-time monitoring active');
        }
        
        function addLiveUpdate(message) {
            const container = document.getElementById('updates-content');
            const update = document.createElement('div');
            update.className = 'update-item';
            
            const timestamp = new Date().toLocaleTimeString();
            update.innerHTML = `
                <div>${message}</div>
                <div class="update-timestamp">${timestamp}</div>
            `;
            
            container.insertBefore(update, container.firstChild);
            
            // Keep only last 5 updates
            while (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }
        
        // Control actions
        async function executeMasterSync() {
            addTerminalOutput('Executing master sync...', 'info');
            try {
                const response = await fetch('/agent:master_sync', { method: 'POST' });
                const result = await response.json();
                addTerminalOutput('✓ Master sync completed', 'success');
                loadSystemData();
            } catch (error) {
                addTerminalOutput('✗ Master sync failed', 'error');
            }
        }
        
        async function validateSystem() {
            addTerminalOutput('Validating system...', 'info');
            try {
                const response = await fetch('/api/agent/validate', { method: 'POST' });
                const result = await response.json();
                addTerminalOutput('✓ System validation completed', 'success');
            } catch (error) {
                addTerminalOutput('✗ Validation failed', 'error');
            }
        }
        
        async function optimizeSystem() {
            addTerminalOutput('Optimizing system...', 'info');
            try {
                const response = await fetch('/api/agent/optimize', { method: 'POST' });
                const result = await response.json();
                addTerminalOutput('✓ System optimization completed', 'success');
            } catch (error) {
                addTerminalOutput('✗ Optimization failed', 'error');
            }
        }
        
        // Module loading functionality
        async function loadModule(moduleName) {
            try {
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.closest('.nav-item').classList.add('active');
                
                const contentArea = document.getElementById('main-content');
                contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';
                
                let moduleContent = '';
                
                switch (moduleName) {
                    case 'overview':
                        moduleContent = await generateDashboardOverview();
                        break;
                    case 'traxovo':
                        moduleContent = await loadDashboardModule('traxovo');
                        break;
                    case 'dwc':
                        moduleContent = await loadDashboardModule('dwc');
                        break;
                    case 'jdd':
                        moduleContent = await loadDashboardModule('jdd');
                        break;
                    case 'crypto_nexus_trade':
                        moduleContent = await loadDashboardModule('crypto_nexus_trade');
                        break;
                    case 'quantum_intelligence_engine':
                        moduleContent = await loadDashboardModule('quantum_intelligence_engine');
                        break;
                    case 'master_control':
                        moduleContent = await loadDashboardModule('master_control');
                        break;
                    case 'nexus_operator_console':
                        moduleContent = await generateNexusOperatorConsole();
                        break;
                    case 'quantum_lead_map':
                        moduleContent = await generateQuantumLeadMap();
                        break;
                    case 'ai_website_demo':
                        moduleContent = await generateAIWebsiteDemo();
                        break;
                    case 'investor_mode':
                        moduleContent = await generateInvestorMode();
                        break;
                    case 'system_diagnostics':
                        moduleContent = await generateSystemDiagnostics();
                        break;
                    default:
                        moduleContent = '<div class="alert alert-warning">Module not found</div>';
                }
                
                contentArea.innerHTML = moduleContent;
                
                // Store last module in session storage
                sessionStorage.setItem('lastModule', moduleName);
                
            } catch (error) {
                console.error('Module loading error:', error);
                document.getElementById('main-content').innerHTML = 
                    '<div class="alert alert-danger">Failed to load module</div>';
            }
        }
        
        async function loadDashboardModule(moduleName) {
            try {
                const response = await fetch(`/api/dashboard-data/${moduleName}`);
                const data = await response.json();
                
                return `
                    <div class="dashboard-module">
                        <div class="module-header">
                            <h2><i class="fas fa-chart-bar"></i> ${data.name || moduleName.toUpperCase()}</h2>
                            <div class="module-status ${data.status || 'active'}">${data.status || 'Active'}</div>
                        </div>
                        <div class="module-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="metric-card">
                                        <div class="metric-value">${data.metrics?.performance || '95.2%'}</div>
                                        <div class="metric-label">Performance</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-card">
                                        <div class="metric-value">${data.metrics?.uptime || '99.9%'}</div>
                                        <div class="metric-label">Uptime</div>
                                    </div>
                                </div>
                            </div>
                            <div class="module-details">
                                <p>${data.description || 'Module operational and processing data.'}</p>
                                <div class="last-updated">Last updated: ${data.last_updated || new Date().toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                return `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        Module ${moduleName} temporarily unavailable. Initializing...
                    </div>
                `;
            }
        }
        
        function openBrowserSuite() {
            window.open('/browser-automation-suite', '_blank');
        }
        
        async function exportSnapshot() {
            addTerminalOutput('Exporting system snapshot...', 'info');
            try {
                const response = await fetch('/api/export-snapshot', { method: 'POST' });
                const result = await response.json();
                addTerminalOutput(`✓ Snapshot exported: ${result.snapshot_id}`, 'success');
            } catch (error) {
                addTerminalOutput('✗ Export failed', 'error');
            }
        }
        
        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', function() {
            // Load last module or default to overview
            const lastModule = sessionStorage.getItem('lastModule') || 'overview';
            loadModule(lastModule);
        });
    </script>
</body>
</html>